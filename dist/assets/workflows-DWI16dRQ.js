import{aj as f,ak as n,al as l,am as a,as as i,av as u,u as w,at as h,au as c,ax as k,ay as p,az as y}from"./index-CIFTxPdQ.js";const m=f("workflows",{state:()=>({workflows:[],isLoading:!1,error:null}),actions:{async fetchWorkflows(){const r=w();if(r.user){this.isLoading=!0;try{const t=k(c(a,"workflows"),p("userId","==",r.user.uid)),o=await y(t);this.workflows=o.docs.map(e=>({id:e.id,...e.data()}))}catch{this.error="Failed to load workflows"}finally{this.isLoading=!1}}},async createWorkflow(r){const t=w();if(t.user){if(t.profile?.tier==="Basic"&&this.workflows.length>=5)throw this.error="Workflow limit reached (5). Upgrade to create more.",new Error(this.error);this.isLoading=!0;try{const o={userId:t.user.uid,name:r,status:"Draft",state:{datasetId:null,preprocessConfig:{},mitigationTechnique:null,modelConfig:{},resultsId:null},createdAt:i(),updatedAt:i()},s={id:(await h(c(a,"workflows"),o)).id,...o};return this.workflows.push(s),s}catch(o){throw this.error="Failed to create workflow",o}finally{this.isLoading=!1}}},async updateWorkflowState(r,t){try{const o={updatedAt:i()};for(const[s,d]of Object.entries(t))o[`state.${s}`]=d;await u(l(a,"workflows",r),o);const e=this.workflows.find(s=>s.id===r);e&&(e.state={...e.state,...t})}catch(o){console.error(o),this.error="Failed to save progress"}},async deleteWorkflow(r){try{await n(l(a,"workflows",r)),this.workflows=this.workflows.filter(t=>t.id!==r)}catch{this.error="Failed to delete workflow"}}}});export{m as u};
